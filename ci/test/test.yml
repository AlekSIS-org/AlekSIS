test:
  interruptible: true
  stage: test
  services:
    - name: browserstack/local
      alias: browserstack-local
      command: ["--key", "$BROWSERSTACK_ACCESS_KEY", "--only-automate", "--local-identifier", "edugit_$CI_JOB_ID"]
  before_script:
    - adduser --disabled-password --gecos "Test User" testuser
    - chown -R testuser .
  script:
    - sudo apt update
    - sudo apt install python3-ldap libldap2-dev libssl-dev libsasl2-dev python3.7-dev -y
    - sudo -u testuser
      env TEST_SELENIUM_HUB=$BROWSERSTACK_USERNAME:$ROWSERSTACK_ACCESS_KEY@hub-cloud.browserstack.com/wd/hub
          TEST_SELENIUM_BROWSERS=chrome,edge,firefox,safari
          TEST_SELENIUM_CAPABILITIES="{'browserstack.local': 'true', 'browserstack.localIdentifier': 'edugit_$CI_JOB_ID', 'project': '$CI_PROJECT_PATH', 'build': '$CI_COMMIT_REF_NAME'}"
          TEST_HOST=build
      tox -e selenium -- --junitxml=.tox/junit.xml
  artifacts:
    paths:
      - .tox/screenshots
    reports:
      junit: .tox/junit.xml
