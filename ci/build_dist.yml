build_dist:
  stage: build
  script:
    - "[ $CI_COMMIT_REF_NAME = master ] && poetry version $(poetry version | cut -d' ' -f2)+$(date +%s).${CI_COMMIT_SHORT_SHA}"
    - tox -e build
    - poetry publish -r gitlab -u gitlab-ci-token -p ${CI_JOB_TOKEN} -u gitlab-ci-token
  artifacts:
    paths:
      - dist/
  only:
    - master
    - tags
