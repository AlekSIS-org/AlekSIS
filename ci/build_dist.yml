build_dist:
  stage: build
  script:
    - if [ $CI_COMMIT_REF_NAME = master ]; then
       poetry version $(poetry version | cut -d" " -f2)+$(date +%s).${CI_COMMIT_SHORT_SHA} ;
      elif [ x$CI_OMMIT_REF_NAME = x$CI_COMMIT_TAG ]; then
       if ! [ "$(poetry version | cut -d" " -f2)" = $CI_COMMIT_REF_NAME ]; then
        echo "Package version does not match tag. Aborting build of tag!" >/dev/fd/2 ;
        exit 1 ;
       fi ;
      fi
    - tox -e build
  artifacts:
    paths:
      - dist/
  only:
    - master
    - tags
